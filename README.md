# Q-Quest 量子神託 (Quantum Oracle)

> Human-Centric Quantum Philosophy  
> 人と人とをつなぐ"縁"が量子技術が創造する

## プロジェクト概要

**Q-Quest 量子神託**は、QUBO（Quadratic Unconstrained Binary Optimization）技術を用いて、日本の伝統的な「縁」の概念を量子技術で表現した価値体験プロジェクトです。

### ビジョン

- **Human-Centric Quantum Philosophy**という新しい潮流を、日本から世界へ発信
- 人と人とをつなぐ"縁"を量子技術が創造する
- 文化の懸け橋となり、次世代に向けた価値体験を提供
- 日本の文化を見直し、世界に向けて発信
- 海外の方が逆に日本を魅力と感じるポイントをしっかり見直して、活かす

## コンセプト

### 量子神託（Quantum Oracle）

従来の「おみくじ」を現代的な量子技術で再解釈。ユーザーの「心の傾き」を分析し、QUBOアルゴリズムを通じて最適な「縁」を提示します。

### 核心的な要素

1. **縁（En）の量子化**: 人と人、人と場所、人と体験の「縁」をQUBOモデルで表現
2. **心の傾き（Mood）の推定**: テキスト入力から感情状態を推定し、QUBOパラメータを動的に調整
3. **量子おみくじ**: ボルツマン分布を用いた確率的な「神託」提示
4. **日本の文化要素**: 季節、俳句、禅的な言葉を用いた体験設計

## 技術スタック

- Python 3.x
- **Streamlit**（Webアプリケーション）⭐
- **NumPy**（数値計算・QUBO計算）
- **Pandas + OpenPyXL**（Excel設定ファイル読み込み）
- Jupyter Notebook（実験・プロトタイプ）

## プロジェクト構造

```
Q-Quest_量子神託/
├── README.md                 # このファイル
├── app07.py                  # Streamlitアプリ（メイン・最新版）⭐
├── requirements.txt          # 依存パッケージ
├── assets/                   # 画像・リソースファイル
│   └── images/
│       └── characters/       # 12神のキャラクター画像（.png）
├── config/                   # Excel設定ファイル（ローカル開発用）
└── docs/                     # ドキュメント
```

## クイックスタート

### 方法1: Streamlitアプリで実行（推奨）⭐

**最も簡単な方法：**

1. **依存パッケージのインストール（初回のみ）**
   ```bash
   pip install -r requirements.txt
   ```

2. **Streamlitアプリを起動**
   ```bash
   streamlit run app07.py
   ```

3. **ブラウザが自動的に開きます**（通常は `http://localhost:8501`）

**または、バッチファイルで起動（Windowsの場合）**
   ```bash
   start_app.bat をダブルクリック
   ```

### 必要なファイル

1. **統合Excel（pack）ファイル**
   - ファイル名例: `quantum_shintaku_pack_v3_with_sense.xlsx`
   - 必須シート:
     - `VOW_DICT`: 誓願辞書（VOW_ID, TITLE, DESCRIPTION_LONG等）
     - `CHAR_MASTER`: キャラクター情報（CHAR_ID, 公式キャラ名等）
     - `CHAR_TO_VOW`: キャラクター×誓願の重み行列（VOW_01, VOW_02, ... + IMAGE_FILE）
   - アプリ起動後、サイドバーからアップロード

2. **格言Excel（任意）**
   - 列: 格言、出典、感覚タグ、公式キャラ名等
   - アプリ起動後、サイドバーからアップロード

3. **キャラクター画像（任意）**
   - 配置場所: `./assets/images/characters/`
   - ファイル名は `CHAR_TO_VOW` の `IMAGE_FILE` 列で指定

## 機能（app07.py）

### 主な機能

1. **テキスト入力からの自動ベクトル化**
   - ユーザーの状況を一文で入力
   - N-gram（3文字）とコサイン類似度で誓願ベクトルを自動推定
   - テキスト入力の影響を可視化（delta(text)）

2. **手動スライダー入力**
   - 各誓願に対して0〜5のスライダーで手動調整可能

3. **手動と自動の混合（mix）**
   - `mix_alpha`パラメータで手動と自動の比率を調整
   - 0.0 = 手動のみ、1.0 = 自動のみ

4. **QUBO計算（エネルギー・確率分布）**
   - エネルギー計算: `E = -W × mix_vec + ノイズ`
   - Softmax分布: `p ∝ exp(-β × E)`
   - サンプリングによる観測分布の可視化

5. **観測結果の表示**
   - 観測されたキャラクター（神）の表示
   - エネルギー、確率、寄与度の表示
   - 寄与した誓願のTop表示
   - エネルギー地形（全候補）の表示
   - 観測分布（サンプル）の可視化

6. **格言の表示（温度付き選択）**
   - 観測されたキャラクターに基づいて格言を選択
   - 温度パラメータでランダム度を調整

### パラメータ調整

- **mix（手動 vs 自動）**: 0.0〜1.0（デフォルト: 0.45）
- **温度（格言選択のランダムさ）**: 0.05〜2.0（デフォルト: 0.70）
- **分布の尖り具合 β**: 0.1〜10.0（デフォルト: 2.2）
- **サンプル回数**: 50〜2000（デフォルト: 400）
- **微小ゆらぎ ε**: 0.0〜0.30（デフォルト: 0.05）

## Excelファイルの形式

### VOW_DICT（誓願辞書）

| 列名 | 説明 | 必須 |
|------|------|------|
| VOW_ID | 誓願ID | ✅ |
| TITLE | 誓願名 | ✅ |
| DESCRIPTION_LONG | 説明（長文） | ⚠️ 推奨 |
| DESCRIPTION | 説明 | ⚠️ 代替 |

### CHAR_MASTER（キャラクター情報）

| 列名 | 説明 | 必須 |
|------|------|------|
| CHAR_ID | キャラクターID | ✅ |
| 公式キャラ名 | キャラクター名 | ✅ |

### CHAR_TO_VOW（キャラクター×誓願の重み行列）

| 列名 | 説明 | 必須 |
|------|------|------|
| CHAR_ID | キャラクターID | ✅ |
| IMAGE_FILE | 画像ファイル名 | ⚠️ 推奨 |
| VOW_01, VOW_02, ... | 各誓願への重み（数値） | ✅ |

## 使い方

### 基本的な使い方

1. **アプリを起動**
   ```bash
   streamlit run app07.py
   ```

2. **統合Excelをアップロード**
   - サイドバーの「統合Excel（quantum_shintaku_pack...）」からファイルを選択

3. **画像フォルダを指定（ローカル実行時）**
   - デフォルト: `./assets/images/characters/`
   - 必要に応じて変更

4. **Step 1: 誓願入力**
   - **テキスト入力**: あなたの状況を一文で入力（例：「疲れていて決断できない」「新規PJを頑張る」）
   - **スライダー**: 各誓願に対して0〜5で手動調整
   - **パラメータ調整**: mix、温度、β、サンプル回数、εを調整

5. **テキスト入力の影響を確認**
   - 右側に「テキスト入力の影響（見える化）」が表示
   - `delta(text)`が大きいほど、文章がその誓願を強めている

6. **観測を実行**
   - 「🧿 観測する（QUBOから抽出）」ボタンをクリック

7. **結果を確認**
   - 観測されたキャラクター（神）が表示
   - 寄与した誓願、エネルギー地形、観測分布が表示
   - 格言が表示（格言Excelをアップロードしている場合）

### 高度な使い方

- **テキストのみで自動推定**: `mix_alpha = 1.0`に設定
- **手動のみ**: `mix_alpha = 0.0`に設定
- **ランダム性を高める**: 温度を上げる、βを下げる、εを上げる
- **確定的に近づける**: 温度を下げる、βを上げる、εを下げる

## 技術的な詳細

### QUBOモデル

エネルギー関数: `E(x) = -W × mix_vec + ノイズ`

- **W**: キャラクター×誓願の重み行列（CHAR_TO_VOWから読み込み）
- **mix_vec**: 手動と自動の混合ベクトル
- **ノイズ**: 微小ゆらぎεによるランダム性

### テキストからの自動ベクトル化

1. **N-gram抽出**: 入力テキストと各誓願の説明文から3文字N-gramを抽出
2. **コサイン類似度計算**: N-gramベクトル間のコサイン類似度を計算
3. **正規化**: 最大値で正規化し、0〜5のスケールに変換

### 確率分布

Softmax分布: `p_i = exp(-β × E_i) / Σ_j exp(-β × E_j)`

- **β（beta）**: 分布の尖り具合（大きいほど低エネルギーに集中）
- **温度（temperature）**: 格言選択時のランダム度

### 観測プロセス

1. エネルギー計算（ノイズ付き）
2. Softmax分布の計算
3. 分布からサンプリングしてキャラクターを選択
4. サンプリング分布の可視化（複数回サンプリング）

## デプロイ

### Streamlit Cloudでデプロイ（推奨）

1. **GitHubリポジトリを作成**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/あなたのユーザー名/リポジトリ名.git
   git push -u origin main
   ```

2. **Streamlit Cloudでデプロイ**
   - [Streamlit Cloud](https://streamlit.io/cloud) にアクセス
   - 「Sign in」→「New app」をクリック
   - リポジトリを選択、Branch: `main`、Main file: `app07.py`
   - 「Deploy」をクリック

**詳細は `GITHUB_DEPLOY.md` を参照してください。**

## 文化的背景

### 日本の魅力ポイント

1. **「縁」の概念**: 人と人との見えないつながりを大切にする文化
2. **おみくじの伝統**: 神社で運勢を占う習慣
3. **季節感（季語）**: 俳句などにみられる季節への敏感さ
4. **間（Ma）の美学**: 「余白」や「遠回り」を価値とする考え方
5. **禅的な言葉**: 「決めなくてよい。保留は、立派な選択である。」

### 世界への発信

これらの要素を量子技術という現代的な手法で表現することで、日本の文化的価値を新しい形で世界に伝えます。

## トラブルシューティング

### よくある問題

1. **Excelファイルが読み込めない**
   - シート名が `VOW_DICT`, `CHAR_MASTER`, `CHAR_TO_VOW` であることを確認
   - 必須列が存在することを確認

2. **画像が表示されない**
   - 画像フォルダのパスを確認
   - `CHAR_TO_VOW` の `IMAGE_FILE` 列に正しいファイル名が記載されているか確認

3. **QUBO計算が動作しない**
   - `app07.py` を使用していることを確認（`app.py` は古いバージョン）
   - 統合Excelが正しく読み込まれているか確認

## 詳細情報

- **プロジェクトビジョン**: `docs/PROJECT_VISION.md`
- **文化的背景**: `docs/CULTURAL_ELEMENTS.md`
- **開発ロードマップ**: `docs/DEVELOPMENT_ROADMAP.md`
- **貢献方法**: `CONTRIBUTING.md`
- **Excel設定ガイド**: `EXCEL_SETUP_GUIDE.md`
- **キャラクター画像の配置**: `CHARACTER_IMAGES_GUIDE.md`

## 貢献

このプロジェクトへの貢献を歓迎します。詳細は `CONTRIBUTING.md` を参照してください。

---

**Q-Quest 量子神託** - Connecting People Through Quantum-Enhanced Destiny
