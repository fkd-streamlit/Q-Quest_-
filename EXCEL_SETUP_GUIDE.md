# Excel設定ファイル ガイド

## 概要

Q-Quest 量子神託アプリでは、4つのExcelファイルから設定を読み込むことができます：

1. **sense_to_vow行列**: 8感覚 → 12誓願の重み（感覚が誓願を引き寄せる）
2. **k行列**: 12神 → 12誓願の重み（誓願がキャラを引き寄せる）
3. **l行列**: 12神 → 4軸の重み（キャラクターの性格ベクトル）
4. **12神基本情報**: 12神の説明文・役割（UI表示用）

これにより、アプリの動作をチューニングしたり、新しい12神の設定を試したりすることができます。

## 4つのExcelファイルの役割

### 1. sense_to_vow_initial_filled_from_user.xlsx ⭐中核データ
**8感覚 → 12誓願の重み（感覚が誓願を引き寄せる）**

- **行**: 8つの感覚（迷い/焦り/静けさ/内省/行動/つながり/挑戦/待つ）
- **列**: 12誓願（誓願01～誓願12）
- **値**: 
  - **負の値（例：-0.4）**: その感覚がその誓願を**引き寄せる**（相性が良い）→ エネルギーを下げる
  - **正の値（例：+0.2）**: その感覚がその誓願を**離す**（相性が悪い）→ エネルギーを上げる
  - **0**: 中立（影響なし）

**役割：**
- **「絵馬の文章 → 願いの方向（誓願）」を数理でつなぐ中核データ**
- QUBOの相互作用項 `H_sense-vow = Σ_{i,j} W_{ij} x_i v_j` の係数 `W_{ij}` を定義
- ユーザーの感覚スコア（0〜5）から「誓願」を自動推定

**例：**
- 迷いが強い → 誓願05/07/10が呼ばれやすい
- 静けさが強い → 誓願02/11が呼ばれやすい

**詳細**: `sense_to_vow行列の説明.md` を参照してください。

### 2. akiba12_character_to_vow_K.xlsx
**12神 → 12誓願の重み（誓願がキャラを引き寄せる）**

- **行**: 12神（キャラクター）
- **列**: 12誓願（誓願01～誓願12）
- **値**: 負の値 = その誓願が選ばれやすい、正の値 = 選ばれにくい

**意味**: この誓願なら、この神が「語り手として自然」という関係を数値で持っている

### 3. akiba12_character_to_axis_L.xlsx
**12神 → 4軸の重み（キャラクターの性格ベクトル）**

- **行**: 12神（キャラクター）
- **列**: 4軸（静・流・間・誠）
- **値**: 負の値 = その世界観軸が強い、正の値 = 弱い

### 4. akiba12_character_list.xlsx
**12神の説明文・役割（UI表示用の辞書）**

12神の基本情報を定義します。

## Excelファイルの構造（1つのファイルに3シートの場合）

Excelファイルは以下の3つのシートを含む必要があります：

### Sheet1: "12神基本情報"

12神の基本情報を定義します。

| 列名 | 説明 | 例 | 必須 |
|------|------|-----|------|
| ID | 神のID（0～11） | 0 | ✅ |
| 名前 | 神の名前（日本語） | 秋葉三尺坊 | ✅ |
| 名前(英語) | 神の名前（英語） | Akiba Sanjakubo | ⚠️ |
| 属性 | 神の属性 | 火 | ⚠️ |
| 絵文字 | 表示用の絵文字 | 🔥 | ⚠️ |
| 説明 | 神の説明 | 秋葉原の守護神。火伏せ=「炎上回避」の神。 | ⚠️ |
| **格言** | **神の格言（神託として表示）** | **勢いMAX: 情熱的な筆致に降臨。** | **⭐推奨** |

**💡 格言について**: 格言を設定すると、そのキャラクターが選ばれた際に、その格言が神託として表示されます。格言がない場合、デフォルトの格言が表示されますが、**より良い体験のためには各キャラクターに格言を設定することを推奨します**。詳細は `格言追加ガイド.md` を参照してください。

### 複数格言（おすすめ）

`格言` セルには **複数の格言** を入れられます（ユーザーの悩み文に応じて、上位2つ程度を自動で組み合わせ表示します）。

- **改行区切り**:
  - 例）  
    `成長::千里の道も一歩から`  
    `不安::話すなら「結論」より「気配」を渡しなさい。`
- **`||` 区切り**:
  - 例）`成長::千里の道も一歩から||不安::境界（しきい）を越えるのは、静かな一歩でよい。`
- **タグなしでもOK**:
  - 例）`焦らず、一歩ずつ。答えは時間が教えてくれる。`

タグ形式 `タグ1,タグ2::本文` を付けると、ユーザー文面から抽出したキーワードにマッチしやすくなります。

### Sheet2: "k行列"

12x12の行列で、キャラクター（行）と誓願（列）の関係を定義します。

- **行**: 12神（0～11の順序で、Sheet1のIDに対応）
- **列**: 誓願01～誓願12
- **値**: 負の値 = その誓願が選ばれやすい、正の値 = 選ばれにくい

例：
```
        誓願01  誓願02  誓願03  ...
秋葉三尺坊  -0.4    0.2    -0.2   ...
真空管大将軍 -0.2    0.2     0.0   ...
...
```

### Sheet3: "l行列"

12x4の行列で、キャラクター（行）と世界観軸（列）の関係を定義します。

- **行**: 12神（0～11の順序で、Sheet1のIDに対応）
- **列**: stillness（静）、flow（流）、ma（間）、sincerity（誠）
- **値**: 負の値 = その世界観軸が強い、正の値 = 弱い

例：
```
        stillness  flow    ma     sincerity
秋葉三尺坊   0.0     -0.2    0.0    -0.4
真空管大将軍  0.0     -0.4    0.0    -0.2
...
```

## テンプレートファイルの生成

テンプレートファイルを生成するには、以下のコマンドを実行します：

```bash
python create_excel_template.py
```

これにより、`12神設定テンプレート.xlsx` ファイルが作成されます。

## Excelファイルのアップロード方法

1. Streamlitアプリを起動します
2. サイドバーの「📊 設定ファイル」セクションで、「Excel設定ファイルをアップロード」をクリック
3. Excelファイル（.xlsx または .xls）を選択
4. ファイルが正常に読み込まれると、「✅ 設定ファイルを読み込みました」と表示されます

## チューニングのヒント

### k行列の調整

- **負の値を大きくする**: その誓願が選ばれやすくなります
- **正の値を大きくする**: その誓願が選ばれにくくなります
- **0に近い値**: その誓願への影響が小さくなります

### l行列の調整

- **stillness（静）**: 疲れや孤独感が高い時に選ばれやすい神を調整
- **flow（流）**: 不安や焦りが高い時に選ばれやすい神を調整
- **ma（間）**: 好奇心が高い時に選ばれやすい神を調整
- **sincerity（誠）**: 決断力が高い時に選ばれやすい神を調整

## 注意事項

- Excelファイルのシート名は正確に「12神基本情報」「k行列」「l行列」である必要があります
- IDは0～11の連続した整数である必要があります
- k行列は12x12、l行列は12x4のサイズである必要があります
- 値は数値（浮動小数点数）である必要があります

## トラブルシューティング

### エラー: "Excelファイルの読み込みエラー"

- シート名が正しいか確認してください
- 列名が正しいか確認してください
- データの型（数値、文字列など）が正しいか確認してください

### エラー: "設定の読み込みに失敗しました"

- Excelファイルが破損していないか確認してください
- ファイル形式が.xlsxまたは.xlsであることを確認してください
- テンプレートファイルを参考にして、構造を確認してください

## サンプルファイル

テンプレートファイル（`12神設定テンプレート.xlsx`）には、現在の12神の設定が含まれています。
このファイルを編集して、新しい設定を試すことができます。